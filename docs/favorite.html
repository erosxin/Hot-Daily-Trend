
        <html>
        <head><meta charset='utf-8' /></head>
        <body>
          <h3>正在收藏...</h3>
          <script>
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            if (!id) { document.body.innerHTML = '<h3>缺少文章ID</h3>'; throw new Error('Missing article ID'); }

            const supabaseUrl = 'https://ietunkxgukxpeacoiigl.supabase.co';
            const supabaseKey = 'sb_publishable_2J74WhPQQZ-U5qgbkUIAsQ_j_VHF4_7';
            
            // 初始化 Supabase client
            const supabase = supabase.createClient(supabaseUrl, supabaseKey);

            // 调用 Edge Function
            async function processFavorite() {
              try {
                // 直接调用（用 service role + API key）
                const response = await fetch(
                  supabaseUrl + '/functions/v1/process-favorite?api_key=default-api-key',
                  {
                    method: 'POST',
                    headers: {
                      'Authorization': 'Bearer ' + supabaseKey,
                      'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ article_id: id })
                  }
                );
                const result = await response.json();
                if (result.success) {
                  document.body.innerHTML = '<h3>收藏成功，简析已生成</h3><p>' + (result.plain_summary || '') + '</p>';
                } else {
                  document.body.innerHTML = '<h3>处理失败: ' + (result.error || '未知错误') + '</h3>';
                }
              } catch (err) {
                document.body.innerHTML = '<h3>错误: ' + err.message + '</h3>';
              }
            }

            processFavorite();
          </script>
        </body>
        </html>
        